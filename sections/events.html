---
layout: default
title: "Events - Viaduct Echo"
permalink: /events/
---

<div class="content-wrapper">
  <div class="row">
    <div class="col-12">
      <h1 class="mb-4">Stockport Events</h1>
      <p class="lead">Discover what's happening around Stockport - from community gatherings to cultural celebrations.</p>

      <!-- Filter Bar -->
      <div class="card mb-4">
        <div class="card-body">
          <div class="row">
            <div class="col-md-4">
              <label for="eventTypeFilter" class="form-label">Filter by Type</label>
              <select id="eventTypeFilter" class="form-select">
                <option value="">All Events</option>
              </select>
            </div>
            <div class="col-md-4">
              <label for="venueFilter" class="form-label">Filter by Venue</label>
              <select id="venueFilter" class="form-select">
                <option value="">All Venues</option>
              </select>
            </div>
            <div class="col-md-4">
              <label for="freeFilter" class="form-label">Price</label>
              <select id="freeFilter" class="form-select">
                <option value="">All Events</option>
                <option value="free">Free Only</option>
                <option value="paid">Paid Only</option>
              </select>
            </div>
          </div>
        </div>
      </div>

      <!-- Loading Indicator -->
      <div id="loadingIndicator" class="text-center my-5">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
        <p class="mt-2">Loading events...</p>
      </div>

      <!-- Events Grid -->
      <div id="eventsGrid" class="row" style="display: none;">
        <!-- Events will be inserted here by JavaScript -->
      </div>

      <!-- No Events Message -->
      <div id="noEventsMessage" class="alert alert-info" role="alert" style="display: none;">
        <h4 class="alert-heading">No Events Found</h4>
        <p>There are currently no events matching your filters. Try adjusting your search criteria.</p>
      </div>

      <!-- Error Message -->
      <div id="errorMessage" class="alert alert-danger" role="alert" style="display: none;">
        <h4 class="alert-heading">Error Loading Events</h4>
        <p id="errorText">Unable to load events. Please try again later.</p>
      </div>
    </div>
  </div>
</div>

<script>
  let allEvents = [];
  let allVenues = new Map();
  let eventTypes = new Set();

  // Load events data
  async function loadEvents() {
    try {
      const response = await fetch('{{ site.baseurl }}/api/events.json');
      if (!response.ok) throw new Error('Failed to load events');
      const data = await response.json();
      allEvents = data.events;

      // Extract unique venues and event types
      allEvents.forEach(event => {
        if (event.venue) {
          allVenues.set(event.venue.id, event.venue);
        }
        if (event.event_type) {
          eventTypes.add(event.event_type);
        }
      });

      populateFilters();
      displayEvents(allEvents);

      document.getElementById('loadingIndicator').style.display = 'none';
      document.getElementById('eventsGrid').style.display = 'flex';
    } catch (error) {
      console.error('Error loading events:', error);
      document.getElementById('loadingIndicator').style.display = 'none';
      document.getElementById('errorMessage').style.display = 'block';
      document.getElementById('errorText').textContent = error.message;
    }
  }

  // Populate filter dropdowns
  function populateFilters() {
    const typeFilter = document.getElementById('eventTypeFilter');
    const venueFilter = document.getElementById('venueFilter');

    // Populate event types
    Array.from(eventTypes).sort().forEach(type => {
      const option = document.createElement('option');
      option.value = type;
      option.textContent = capitalizeFirst(type);
      typeFilter.appendChild(option);
    });

    // Populate venues
    Array.from(allVenues.values())
      .sort((a, b) => a.name.localeCompare(b.name))
      .forEach(venue => {
        const option = document.createElement('option');
        option.value = venue.id;
        option.textContent = venue.name;
        venueFilter.appendChild(option);
      });
  }

  // Display events
  function displayEvents(events) {
    const grid = document.getElementById('eventsGrid');
    const noEventsMsg = document.getElementById('noEventsMessage');

    grid.innerHTML = '';

    if (events.length === 0) {
      grid.style.display = 'none';
      noEventsMsg.style.display = 'block';
      return;
    }

    noEventsMsg.style.display = 'none';
    grid.style.display = 'flex';

    events.forEach(event => {
      const eventCard = createEventCard(event);
      grid.appendChild(eventCard);
    });
  }

  // Create event card HTML
  function createEventCard(event) {
    const col = document.createElement('div');
    col.className = 'col-md-6 col-lg-4 mb-4';

    const eventDate = new Date(event.start_datetime);
    const dateStr = eventDate.toLocaleDateString('en-GB', {
      weekday: 'short',
      day: 'numeric',
      month: 'short',
      year: 'numeric'
    });
    const timeStr = eventDate.toLocaleTimeString('en-GB', {
      hour: '2-digit',
      minute: '2-digit'
    });

    const priceText = event.is_free ? 'Free' :
                      (event.price_min && event.price_max) ? `£${event.price_min} - £${event.price_max}` :
                      event.price_min ? `From £${event.price_min}` : 'See website';

    col.innerHTML = `
      <div class="card h-100">
        ${event.image_url ? `<img src="${event.image_url}" class="card-img-top" alt="${event.title}" style="height: 200px; object-fit: cover;">` : ''}
        <div class="card-body d-flex flex-column">
          <h5 class="card-title">${event.title}</h5>
          <p class="card-text text-muted">
            <i class="far fa-calendar"></i> ${dateStr}<br>
            <i class="far fa-clock"></i> ${timeStr}<br>
            ${event.venue ? `<i class="fas fa-map-marker-alt"></i> ${event.venue.name}` : ''}
          </p>
          <p class="card-text">
            <span class="badge bg-primary">${capitalizeFirst(event.event_type)}</span>
            <span class="badge ${event.is_free ? 'bg-success' : 'bg-secondary'}">${priceText}</span>
          </p>
          <div class="mt-auto">
            <a href="${event.ticket_url}" class="btn btn-primary btn-sm" target="_blank" rel="noopener">Get Tickets</a>
          </div>
        </div>
      </div>
    `;

    return col;
  }

  // Filter events
  function filterEvents() {
    const typeFilter = document.getElementById('eventTypeFilter').value;
    const venueFilter = document.getElementById('venueFilter').value;
    const freeFilter = document.getElementById('freeFilter').value;

    let filtered = allEvents;

    if (typeFilter) {
      filtered = filtered.filter(e => e.event_type === typeFilter);
    }

    if (venueFilter) {
      filtered = filtered.filter(e => e.venue && e.venue.id == venueFilter);
    }

    if (freeFilter === 'free') {
      filtered = filtered.filter(e => e.is_free);
    } else if (freeFilter === 'paid') {
      filtered = filtered.filter(e => !e.is_free);
    }

    displayEvents(filtered);
  }

  // Utility function
  function capitalizeFirst(str) {
    return str.charAt(0).toUpperCase() + str.slice(1);
  }

  // Add event listeners
  document.getElementById('eventTypeFilter').addEventListener('change', filterEvents);
  document.getElementById('venueFilter').addEventListener('change', filterEvents);
  document.getElementById('freeFilter').addEventListener('change', filterEvents);

  // Load events on page load
  loadEvents();
</script>

<style>
  .card-img-top {
    border-bottom: 1px solid #dee2e6;
  }

  .card-title {
    font-size: 1.1rem;
    font-weight: 600;
    line-height: 1.3;
  }

  .badge {
    font-size: 0.75rem;
    margin-right: 0.25rem;
  }
</style>
