---
layout: default
title: "Events - Viaduct Echo"
permalink: /events/
---

<div class="content-wrapper">
  <div class="row">
    <div class="col-12">
      <h1 class="mb-4">Stockport Events</h1>
      <p class="lead">Discover what's happening around Stockport - from community gatherings to cultural celebrations.</p>

      <!-- Loading Indicator -->
      <div id="loadingIndicator" class="text-center my-5">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
        <p class="mt-2">Loading events...</p>
      </div>

      <!-- Events Grid -->
      <div id="eventsGrid" class="row" style="display: none;">
        <!-- Events will be inserted here by JavaScript -->
      </div>

      <!-- No Events Message -->
      <div id="noEventsMessage" class="alert alert-info" role="alert" style="display: none;">
        <h4 class="alert-heading">No Events Found</h4>
        <p>There are currently no events matching your filters. Try adjusting your search criteria.</p>
      </div>

      <!-- Error Message -->
      <div id="errorMessage" class="alert alert-danger" role="alert" style="display: none;">
        <h4 class="alert-heading">Error Loading Events</h4>
        <p id="errorText">Unable to load events. Please try again later.</p>
      </div>
    </div>
  </div>
</div>

<script>
  let allEvents = [];

  // Load events data
  async function loadEvents() {
    try {
      const response = await fetch('{{ site.baseurl }}/api/events.json');
      if (!response.ok) throw new Error('Failed to load events');
      const data = await response.json();
      allEvents = data.events;

      displayEvents(allEvents);

      document.getElementById('loadingIndicator').style.display = 'none';
      document.getElementById('eventsGrid').style.display = 'flex';
    } catch (error) {
      console.error('Error loading events:', error);
      document.getElementById('loadingIndicator').style.display = 'none';
      document.getElementById('errorMessage').style.display = 'block';
      document.getElementById('errorText').textContent = error.message;
    }
  }

  // Display events
  function displayEvents(events) {
    const grid = document.getElementById('eventsGrid');
    const noEventsMsg = document.getElementById('noEventsMessage');

    grid.innerHTML = '';

    if (events.length === 0) {
      grid.style.display = 'none';
      noEventsMsg.style.display = 'block';
      return;
    }

    noEventsMsg.style.display = 'none';
    grid.style.display = 'flex';

    events.forEach(event => {
      const eventCard = createEventCard(event);
      grid.appendChild(eventCard);
    });
  }

  // Create event card HTML
  function createEventCard(event) {
    const col = document.createElement('div');
    col.className = 'col-md-6 col-lg-4 mb-4';

    const eventDate = new Date(event.start_datetime);
    const dateStr = eventDate.toLocaleDateString('en-GB', {
      weekday: 'short',
      day: 'numeric',
      month: 'short',
      year: 'numeric'
    });
    const timeStr = eventDate.toLocaleTimeString('en-GB', {
      hour: '2-digit',
      minute: '2-digit'
    });

    const priceText = event.is_free ? 'Free' :
                      (event.price_min && event.price_max) ? `£${event.price_min} - £${event.price_max}` :
                      event.price_min ? `From £${event.price_min}` : 'See website for prices';

    // Create Google Maps URL
    const mapsUrl = event.venue ?
      `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(event.venue.name + ', ' + event.venue.postcode)}` :
      '';

    col.innerHTML = `
      <div class="card h-100">
        ${event.image_url && event.ticket_url ?
          `<a href="${event.ticket_url}" target="_blank" rel="noopener">
            <img src="${event.image_url}" class="card-img-top event-image" alt="${event.title}" style="height: 200px; object-fit: cover;">
          </a>` :
          event.image_url ?
            `<img src="${event.image_url}" class="card-img-top" alt="${event.title}" style="height: 200px; object-fit: cover;">` :
            ''
        }
        <div class="card-body d-flex flex-column">
          ${event.ticket_url ?
            `<h5 class="card-title"><a href="${event.ticket_url}" target="_blank" rel="noopener" class="event-title-link">${event.title}</a></h5>` :
            `<h5 class="card-title">${event.title}</h5>`
          }
          <p class="card-text text-muted">
            <i class="far fa-calendar"></i> ${dateStr}<br>
            <i class="far fa-clock"></i> ${timeStr}<br>
            ${event.venue ?
              `<i class="fas fa-map-marker-alt"></i> <a href="${mapsUrl}" target="_blank" rel="noopener" class="venue-link">${event.venue.name}</a>` :
              ''
            }
          </p>
          <p class="card-text">
            <span class="badge ${event.is_free ? 'bg-success' : 'bg-secondary'}">${priceText}</span>
          </p>
        </div>
      </div>
    `;

    return col;
  }

  // Load events on page load
  loadEvents();
</script>

<style>
  .card-img-top {
    border-bottom: 1px solid #dee2e6;
  }

  .event-image {
    transition: opacity 0.2s;
  }

  .event-image:hover {
    opacity: 0.85;
  }

  .card-title {
    font-size: 1.1rem;
    font-weight: 600;
    line-height: 1.3;
  }

  .event-title-link {
    color: inherit;
    text-decoration: none;
    transition: color 0.2s;
  }

  .event-title-link:hover {
    color: #0d6efd;
    text-decoration: none;
  }

  .venue-link {
    color: #6c757d;
    text-decoration: none;
    transition: color 0.2s;
  }

  .venue-link:hover {
    color: #0d6efd;
    text-decoration: underline;
  }

  .badge {
    font-size: 0.75rem;
    margin-right: 0.25rem;
    color: #f8f9fa !important;
  }
</style>
